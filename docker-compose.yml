services:

  wg-rusteze-init:
    container_name: wg-rusteze-init-cnt
    build:
      target: initializer
    environment:
      NETWORK_IDENTIFIER: wg-rusteze
      NETWORK_SUBNET: 10.0.34.0/24

      AGENT_PEER_NAME: wg-rusteze-host
      AGENT_LOCAL_ADDRESS: 0.0.0.0
      AGENT_LOCAL_WEB_PORT: 80
      AGENT_LOCAL_VPN_PORT: 51820
      AGENT_PUBLIC_ADDRESS: 1.2.3.4
      AGENT_PUBLIC_VPN_PORT: 51820
      AGENT_INTERNAL_VPN_ADDRESS: 10.0.34.1
      AGENT_USE_TLS: true
      AGENT_ENABLE_WEB_PASSWORD: false
      AGENT_WEB_PASSWORD: ""
      AGENT_ENABLE_DNS: true
      AGENT_DNS_SERVER: 1.1.1.1
      AGENT_ENABLE_MTU: false
      AGENT_MTU_VALUE: ""
      AGENT_ENABLE_SCRIPT_PRE_UP: false
      AGENT_SCRIPT_PRE_UP_LINE: ""
      AGENT_ENABLE_SCRIPT_POST_UP: false
      AGENT_SCRIPT_POST_UP_LINE: ""
      AGENT_ENABLE_SCRIPT_PRE_DOWN: false
      AGENT_SCRIPT_PRE_DOWN_LINE: ""
      AGENT_ENABLE_SCRIPT_POST_DOWN: false
      AGENT_SCRIPT_POST_DOWN_LINE: ""

      DEFAULT_ENABLE_DNS: true
      DEFAULT_DNS_SERVER: 1.1.1.1
      DEFAULT_ENABLE_MTU: false
      DEFAULT_MTU_VALUE: ""
      DEFAULT_ENABLE_SCRIPT_PRE_UP: false
      DEFAULT_SCRIPT_PRE_UP_LINE: ""
      DEFAULT_ENABLE_SCRIPT_POST_UP: false
      DEFAULT_SCRIPT_POST_UP_LINE: ""
      DEFAULT_ENABLE_SCRIPT_PRE_DOWN: false
      DEFAULT_SCRIPT_PRE_DOWN_LINE: ""
      DEFAULT_ENABLE_SCRIPT_POST_DOWN: false
      DEFAULT_SCRIPT_POST_DOWN_LINE: ""
      DEFAULT_ENABLE_PERSISTENT_KEEPALIVE: true
      DEFAULT_PERSISTENT_KEEPALIVE_PERIOD: 25
    volumes:
      - .wg-rusteze-docker:/app/.wg-rusteze

  # create cert using mkcert
  # install cert using a wg-rusteze command
  wg-rusteze-runner:
    build:
      target: runner
    volumes:
      - .wg-rusteze-docker:/app/.wg-rusteze

  wg-rusteze-config-reset-web-password:
    container_name: wg-rusteze-config-reset-web-password-cnt
    extends:
      service: wg-rusteze-runner
    command: [ "/app/wg-rusteze", "config", "reset-web-password", "--password", "test" ]

  wg-rusteze-config-enable-web-password:
    container_name: wg-rusteze-config-enable-web-password-cnt
    extends:
      service: wg-rusteze-runner
    command: [ "/app/wg-rusteze", "config", "enable-web-password" ]

  wg-rusteze-config-disable-web-password:
    container_name: wg-rusteze-config-disable-web-password-cnt
    extends:
      service: wg-rusteze-runner
    command: [ "/app/wg-rusteze", "config", "disable-web-password" ]

  wg-rusteze-agent-run-only-web:
    container_name: wg-rusteze-agent-run-only-web-cnt
    extends:
      service: wg-rusteze-runner
    ports:
      - "80:80"
    command: [ "/app/wg-rusteze", "agent", "run", "--only-web" ]
